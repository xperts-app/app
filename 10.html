<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Exam Result - Admin</title>
    <!-- Styles are the same -->
    <style>:root{/*...All styles...*/}</style>
</head>
<body>
    <div class="main-container">
        <!-- The UI is the same, with the simplified dropdown -->
        <div class="selection-area">
            <label for="class-select">Step 1: Select a Class</label>
            <select id="class-select">
                <option value="">-- Choose a class --</option>
                <option value="6">6th</option><option value="7">7th</option><option value="8">8th</option>
                <option value="9">9th</option><option value="10">10th</option><option value="11">11th</option><option value="12">12th</option>
            </select>
        </div>
        <!-- ... rest of the form ... -->
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyD-ers6CRuH8bCFomXJHuLxPWff-Xa4ZVk", /*...*/ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const classSelect = document.getElementById('class-select');
        const studentSelect = document.getElementById('student-select');
        // ... other variables ...

        classSelect.addEventListener('change', async (e) => {
            const selectedClass = e.target.value;
            // ... reset UI ...
            if (!selectedClass) return;
            studentSelect.innerHTML = '<option value="">Loading students...</option>';

            try {
                // THE FINAL, SIMPLE, AND CORRECT QUERY
                const snapshot = await db.collection('users')
                    .where('class', '==', selectedClass)
                    .where('role', '==', 'Student')
                    .get();

                const students = [];
                snapshot.forEach(doc => students.push({ id: doc.id, name: doc.data().fullName }));
                students.sort((a,b) => a.name.localeCompare(b.name));

                if (students.length === 0) { studentSelect.innerHTML = '<option value="">-- No students found --</option>'; return; }
                
                studentSelect.innerHTML = '<option value="">-- Select a student --</option>';
                students.forEach(student => { studentSelect.innerHTML += `<option value="${student.id}" data-name="${student.name}">${student.name}</option>`; });
                studentSelect.disabled = false;

            } catch (error) { console.error("Error fetching students:", error); studentSelect.innerHTML = '<option value="">-- Error --</option>'; }
        });

        // The save button logic is the same and correct.
    </script>
</body>
</html>
