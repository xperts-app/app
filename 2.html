<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - ALLEN</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&display=swap');
        body { font-family: 'Manrope', sans-serif; background-color: #f0f2f7; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px 0; }
        .container { background-color: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); width: 100%; max-width: 420px; text-align: center; }
        .progress-bar { width: 100%; background-color: #e0e0e0; border-radius: 5px; overflow: hidden; height: 8px; margin-bottom: 30px; }
        .progress { width: 10%; background-color: #007bff; height: 100%; transition: width 0.4s ease; }
        .step { display: none; }
        .step.active { display: block; }
        .icon { margin: 20px auto 40px; width: 120px; height: 120px; }
        h2 { font-weight: 800; font-size: 22px; color: #333; }
        p, .sub-heading { color: #555; font-size: 16px; margin-bottom: 25px; }
        .input-field { width: calc(100% - 32px); padding: 15px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; margin-bottom: 20px; }
        .btn { padding: 12px 20px; border: 1px solid #ccc; border-radius: 10px; background-color: #fff; cursor: pointer; font-size: 16px; font-weight: 700; margin: 5px; transition: all 0.2s; }
        .btn:hover, .btn.selected { background-color: #007bff; color: white; border-color: #007bff; }
        .btn-container { display: flex; flex-wrap: wrap; justify-content: center; margin-bottom: 20px; }
        .nav-btn { width: calc(50% - 10px); padding: 15px; border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 20px; }
        .next-btn { background-color: #007bff; color: white; }
        .next-btn:disabled { background-color: #a0cffc; cursor: not-allowed; }
        .back-btn { background-color: #e9ecef; color: #495057; }
        .input-group { text-align: left; margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 700; font-size: 14px; }
        #error-message { color: #d93025; margin-top: 15px; font-size: 14px; min-height: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="progress-bar">
        <div class="progress" id="progress"></div>
    </div>

    <!-- Step 1: Full Name -->
    <div id="step-1" class="step active">
        <svg class="icon" viewBox="0 0 200 200"><g transform="translate(100 100)"><path d="M72.5-12.3C89.1,9.6,94.5,41.9,82.5,62.2C70.5,82.5,41.1,90.8,14.6,89.5C-11.8,88.2,-35.3,77.3,-52,58.8C-68.7,40.3,-78.6,14.2,-75,-10.1C-71.3,-34.4,-54.1,-57,-34.2,-68.6C-14.3,-80.2,8.2,-80.8,29.9,-70.7C51.6,-60.6,72.5,-34.4,72.5-12.3Z" fill="#ffc107"></path></g></svg>
        <h2>We are excited to have you join the ALLEN family!</h2>
        <p class="sub-heading">What should we call you?</p>
        <input type="text" id="fullName" class="input-field" placeholder="Student's full name">
        <button class="nav-btn next-btn" onclick="nextStep(1)">Next</button>
    </div>

    <!-- Step 2: Goal -->
    <div id="step-2" class="step">
        <svg class="icon" viewBox="0 0 200 200"><g transform="translate(100 100)"><path d="M21.5,-40.3C33.2,-29.4,50.8,-28.9,59.3,-22C67.8,-15.1,67.2,-1.8,61.4,10.1C55.6,22,44.6,32.5,32.7,44.9C20.8,57.3,8,71.6,-5.5,73.6C-19,75.7,-33.1,65.5,-44.6,53.4C-56.1,41.2,-65,27.1,-68.8,11.3C-72.7,-4.5,-71.4,-22,-62.1,-33.2C-52.8,-44.3,-35.4,-49,-20.9,-51.2C-6.4,-53.4,5.4,-51.2,21.5,-40.3Z" fill="#007bff"></path></g></svg>
        <h2>Hi, <span id="displayName"></span></h2>
        <p class="sub-heading">Please tell us your goal?</p>
        <div class="btn-container" id="goal-container">
            <button class="btn" data-value="NEET">NEET</button>
            <button class="btn" data-value="JEE">JEE</button>
            <button class="btn" data-value="Class 6-10">Class 6-10</button>
        </div>
        <button class="nav-btn back-btn" onclick="prevStep(2)">Back</button>
        <button class="nav-btn next-btn" onclick="nextStep(2)">Next</button>
    </div>

    <!-- Step 3: Class -->
    <div id="step-3" class="step">
         <svg class="icon" viewBox="0 0 200 200"><g transform="translate(100 100)"><path d="M49.3,-41.8C62.8,-27.4,71.8,-6.2,69.5,13.2C67.2,32.6,53.6,50.1,36.9,58.9C20.2,67.7,0.4,67.7,-19.6,61.1C-39.6,54.6,-59.8,41.4,-67.9,23.9C-76.1,6.4,-72.2,-15.5,-60.7,-31C-49.2,-46.5,-30,-55.6,-11.2,-57.4C7.5,-59.2,25.8,-54.2,49.3,-41.8Z" fill="#28a745"></path></g></svg>
        <h2>You selected, <span id="displayGoal"></span>!</h2>
        <p class="sub-heading" id="class-sub-heading"></p>
        <div class="btn-container" id="class-container">
            <!-- Class buttons will be generated by JS -->
        </div>
        <button class="nav-btn back-btn" onclick="prevStep(3)">Back</button>
        <button class="nav-btn next-btn" onclick="nextStep(3)">Next</button>
    </div>
    
    <!-- Step 4: Board -->
    <div id="step-4" class="step">
        <svg class="icon" viewBox="0 0 200 200"><g transform="translate(100 100)"><path d="M49.3,-41.8C62.8,-27.4,71.8,-6.2,69.5,13.2C67.2,32.6,53.6,50.1,36.9,58.9C20.2,67.7,0.4,67.7,-19.6,61.1C-39.6,54.6,-59.8,41.4,-67.9,23.9C-76.1,6.4,-72.2,-15.5,-60.7,-31C-49.2,-46.5,-30,-55.6,-11.2,-57.4C7.5,-59.2,25.8,-54.2,49.3,-41.8Z" fill="#ffc107"></path></g></svg>
        <h2>Great! Just a few more details.</h2>
        <p class="sub-heading">Which board are you from?</p>
        <div class="btn-container" id="board-container">
             <button class="btn" data-value="CBSE">CBSE</button>
             <button class="btn" data-value="ICSE">ICSE</button>
             <button class="btn" data-value="State Board">State Board</button>
             <button class="btn" data-value="Others">Others</button>
        </div>
        <button class="nav-btn back-btn" onclick="prevStep(4)">Back</button>
        <button class="nav-btn next-btn" onclick="nextStep(4)">Next</button>
    </div>

    <!-- Step 5: Final Details -->
    <div id="step-5" class="step">
         <svg class="icon" viewBox="0 0 200 200"><g transform="translate(100 100)"><path d="M57.8,-42.9C69,-26.8,68.1,-1.3,61,19.3C53.9,39.9,40.6,55.6,23.3,62.8C6.1,70,-15.1,68.7,-32.1,59.3C-49.1,49.9,-61.9,32.4,-66.2,12.7C-70.5,-7.1,-66.3,-29.1,-53.4,-44C-40.5,-58.9,-18.8,-66.7,2.8,-68.2C24.4,-69.7,46.5,-59,57.8,-42.9Z" fill="#17a2b8"></path></g></svg>
        <h2>Final Step!</h2>
        <p class="sub-heading">Provide your account details.</p>
        <div class="input-group">
            <label for="dob">Date of Birth</label>
            <input type="date" id="dob" class="input-field">
        </div>
        <div class="input-group">
            <label for="parentName">Parent's Name</label>
            <input type="text" id="parentName" class="input-field" placeholder="Parent's Name">
        </div>
        <div class="input-group">
            <label for="email">Email ID</label>
            <input type="email" id="email" class="input-field" placeholder="you@example.com">
        </div>
        <div class="input-group">
            <label for="password-signup">Password</label>
            <input type="password" id="password-signup" class="input-field" placeholder="Choose a strong password">
        </div>
        <p id="error-message"></p>
        <button class="nav-btn back-btn" onclick="prevStep(5)">Back</button>
        <button class="nav-btn next-btn" onclick="submitForm()">Create Account</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
    // --- IMPORTANT: REPLACE WITH YOUR FIREBASE CONFIG ---
    const firebaseConfig = {
        apiKey: "AIzaSyD-ers6CRuH8bCFomXJHuLxPWff-Xa4ZVk",
        authDomain: "xperts-data.firebaseapp.com",
        projectId: "xperts-data",
        storageBucket: "xperts-data.appspot.com",
        messagingSenderId: "934675149024",
        appId: "1:934675149024:web:23486a5f38f65f103ce085",
        measurementId: "G-6TS06NTDZQ"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentStep = 1;
    const totalSteps = 5;
    const formData = {};

    document.addEventListener('DOMContentLoaded', () => {
        // Get mobile number from URL
        const urlParams = new URLSearchParams(window.location.search);
        formData.mobile = urlParams.get('mobile');
        if (!formData.mobile) {
            alert('Mobile number not found. Redirecting to login.');
            window.location.href = '1.html';
        }
        
        // Setup button selections
        setupChoiceSelection('goal-container');
        setupChoiceSelection('class-container');
        setupChoiceSelection('board-container');
    });

    function setupChoiceSelection(containerId) {
        const container = document.getElementById(containerId);
        container.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn')) {
                // Deselect other buttons in the same container
                const buttons = container.querySelectorAll('.btn');
                buttons.forEach(btn => btn.classList.remove('selected'));
                // Select the clicked button
                e.target.classList.add('selected');
            }
        });
    }
    
    function updateProgressBar() {
        const progress = document.getElementById('progress');
        progress.style.width = `${((currentStep - 1) / (totalSteps - 1)) * 100}%`;
    }

    function nextStep(step) {
        if (!validateStep(step)) return;

        document.getElementById(`step-${step}`).classList.remove('active');
        currentStep++;
        document.getElementById(`step-${currentStep}`).classList.add('active');
        updateProgressBar();
        
        // Custom logic for entering the next step
        if (currentStep === 2) {
            document.getElementById('displayName').textContent = formData.fullName;
        }
        if (currentStep === 3) {
            document.getElementById('displayGoal').textContent = formData.goal;
            generateClassButtons(formData.goal);
        }
    }
    
    function prevStep(step) {
        document.getElementById(`step-${step}`).classList.remove('active');
        currentStep--;
        document.getElementById(`step-${currentStep}`).classList.add('active');
        updateProgressBar();
    }

    function validateStep(step) {
        // Clear previous errors
        document.getElementById('error-message').textContent = '';
        
        if (step === 1) {
            const fullName = document.getElementById('fullName').value.trim();
            if (fullName.length < 3) { alert("Please enter your full name."); return false; }
            formData.fullName = fullName;
        }
        if (step === 2) {
            const selectedGoal = document.querySelector('#goal-container .btn.selected');
            if (!selectedGoal) { alert("Please select a goal."); return false; }
            formData.goal = selectedGoal.dataset.value;
        }
        if (step === 3) {
            const selectedClass = document.querySelector('#class-container .btn.selected');
            if (!selectedClass) { alert("Please select your class."); return false; }
            formData.class = selectedClass.dataset.value;
        }
        if (step === 4) {
            const selectedBoard = document.querySelector('#board-container .btn.selected');
            if (!selectedBoard) { alert("Please select your board."); return false; }
            formData.board = selectedBoard.dataset.value;
        }
        return true;
    }

    function generateClassButtons(goal) {
        const container = document.getElementById('class-container');
        let subHeading = document.getElementById('class-sub-heading');
        container.innerHTML = ''; // Clear previous buttons
        let classes = [];
        let subHeadingText = "Which class are you in?";
        
        if (goal === "Class 6-10") {
            classes = ["6th", "7th", "8th", "9th", "10th"];
            subHeadingText = "36 medals won in International Olympiads";
        } else if (goal === "NEET" || goal === "JEE") {
            classes = ["11th", "12th"];
            subHeadingText = goal === "NEET" ? "1 lakh+ qualifications in NEET UG 2023" : "Top ranks in JEE Advanced";
        }

        subHeading.textContent = subHeadingText;
        classes.forEach(c => {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.dataset.value = c;
            btn.textContent = c;
            container.appendChild(btn);
        });
    }

    async function submitForm() {
        const errorEl = document.getElementById('error-message');
        errorEl.textContent = '';

        // Collect final details
        formData.dob = document.getElementById('dob').value;
        formData.parentName = document.getElementById('parentName').value.trim();
        formData.email = document.getElementById('email').value.trim();
        const password = document.getElementById('password-signup').value;

        // Final validation
        if (!formData.dob || !formData.parentName || !formData.email || password.length < 6) {
            errorEl.textContent = 'Please fill all fields. Password must be at least 6 characters.';
            return;
        }

        try {
            // 1. Create user in Firebase Authentication
            const userCredential = await auth.createUserWithEmailAndPassword(formData.email, password);
            const user = userCredential.user;

            // 2. Create user document in Firestore
            await db.collection('users').doc(user.uid).set({
                uid: user.uid,
                fullName: formData.fullName,
                email: formData.email,
                mobile: formData.mobile,
                goal: formData.goal,
                class: formData.class,
                board: formData.board,
                dob: formData.dob,
                parentName: formData.parentName,
                role: 'Student',      // Default role
                isAllowed: false,     // Default status
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            alert('Signup successful! You will be redirected to the login page. An admin needs to approve your account before you can fully access the platform.');
            window.location.href = '1.html';

        } catch (error) {
            console.error("Signup Error:", error);
            errorEl.textContent = error.message;
        }
    }
</script>

</body>
</html>
