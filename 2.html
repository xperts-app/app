<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proceed to Your Class</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
        html, body { height: 100%; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
        body { display: flex; justify-content: center; align-items: center; text-align: center; background-color: #f0f4f9; color: #333; transition: background-color 0.3s; }
        body.loading { cursor: wait; } body.ready { cursor: pointer; background-color: #e7f1ff; } body.error { cursor: default; background-color: #ffebee; }
        .message-box { padding: 20px; } h1 { font-size: 2.5rem; font-weight: 600; color: #1d2c3c; } p { font-size: 1.2rem; color: #5a6b7d; }
    </style>
</head>
<body class="loading">
    <div class="message-box">
        <h1 id="main-heading">Loading Your Session...</h1>
        <p id="sub-text">Please wait while we prepare your destination.</p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyD-ers6CRuH8bCFomXJHuLxPWff-Xa4ZVk", authDomain: "xperts-data.firebaseapp.com", projectId: "xperts-data", storageBucket: "xperts-data.firebasestorage.app", messagingSenderId: "934675149024", appId: "1:934675149024:web:23486a5f38f65f103ce085" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const bodyEl = document.querySelector('body');
        const mainHeadingEl = document.getElementById('main-heading');
        const subTextEl = document.getElementById('sub-text');

        // This map now has keys that match our new, clean data structure
        const classUrlMap = {
            '6': 'https://abc.xyz/6', '7': 'https://abc.xyz/7', '8': 'https://abc.xyz/8',
            '9': 'https://abc.xyz/9', '10': 'https://abc.xyz/10',
            // Note the keys are now combinations of class and goal
            '11-NEET': 'https://abc.xyz/N11', '11-JEE': 'https://abc.xyz/J11',
            '12-NEET': 'https://abc.xyz/N12', '12-JEE': 'https://abc.xyz/J12'
        };

        function showMessage(heading, subtext, status = 'loading') { /* ... same as before ... */ }

        document.addEventListener('DOMContentLoaded', async () => {
            const userId = localStorage.getItem('loggedInUserId');
            if (!userId) { /* ... handle not logged in ... */ return; }

            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (!userDoc.exists) { /* ... handle user not found ... */ return; }

                const userData = userDoc.data();
                const { class: userClass, goal: userGoal, role: userRole } = userData;
                
                // Handle non-student roles
                if (userRole !== 'Student') { /* ... handle admin/teacher redirect ... */ return; }
                if (!userClass) { /* ... handle incomplete profile ... */ return; }

                // --- NEW UNAMBIGUOUS LOGIC ---
                let lookupKey = userClass; // Default key is just the class (e.g., "6", "10")
                
                // If there's a specific goal, create a composite key
                if (userGoal === 'NEET' || userGoal === 'JEE') {
                    lookupKey = `${userClass}-${userGoal}`; // e.g., "11-NEET"
                }
                
                const redirectUrl = classUrlMap[lookupKey];
                // --- END OF NEW LOGIC ---

                if (!redirectUrl) {
                    showMessage('Configuration Error', `Could not find a valid destination for your class ("${lookupKey}").`, 'error');
                    return;
                }

                // Success Case
                showMessage('Ready to Go!', 'Click anywhere on the page to proceed.');
                bodyEl.classList.add('ready');
                bodyEl.addEventListener('click', () => {
                    showMessage('Redirecting...', 'Please wait.');
                    window.location.href = redirectUrl;
                });

            } catch (error) { /* ... handle fetch error ... */ }
        });
    </script>
</body>
</html>
