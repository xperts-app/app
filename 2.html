<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Your Experience - ALLEN</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; background-color: #f0f4f9; margin: 0; padding-top: 50px; }
        .main-container { max-width: 450px; margin: auto; padding: 20px; }
        .progress-bar-container { width: 100%; background-color: #e0e0e0; border-radius: 5px; margin-bottom: 40px; }
        .progress-bar { width: 20%; height: 6px; background-color: #007bff; border-radius: 5px; transition: width 0.4s ease-in-out; }
        .step { display: none; text-align: center; }
        .step.active { display: block; }
        .illustration { width: 150px; height: 150px; margin: 0 auto 30px auto; }
        h2 { font-weight: 600; font-size: 24px; color: #1d2c3c; margin-bottom: 8px; }
        p { color: #5a6b7d; font-size: 16px; margin-bottom: 30px; }
        .text-input { width: 100%; padding: 15px; border: 1px solid #ccc; border-radius: 12px; font-size: 16px; margin-bottom: 20px; box-sizing: border-box; }
        .btn-primary { background-color: #007bff; color: white; border: none; padding: 15px 0; border-radius: 12px; font-size: 18px; font-weight: 600; width: 100%; cursor: pointer; transition: background-color 0.3s; }
        .btn-primary:disabled { background-color: #a0cffd; cursor: not-allowed; }
        .selection-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }
        .selection-btn { background-color: #fff; border: 1px solid #ddd; border-radius: 12px; padding: 20px; font-size: 16px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .selection-btn.selected { border-color: #007bff; background-color: #e7f1ff; color: #007bff; }
        .back-arrow { position: absolute; top: 20px; left: 20px; width: 40px; height: 40px; background-color: #e0e0e0; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 20px; color: #333; text-decoration: none; }
    </style>
</head>
<body>
    <a href="#" id="back-btn" class="back-arrow" style="display: none;">‚Üê</a>
    <div class="main-container">
        <div class="progress-bar-container"><div class="progress-bar" id="progress-bar"></div></div>
        <form id="signup-form">
            <!-- Step 1: Name -->
            <div class="step active" data-step="1">
                <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="45" fill="#e0f7fa"/><path d="M50 25 C65 25 68 35 68 45 C68 60 50 80 50 80 C50 80 32 60 32 45 C32 35 35 25 50 25 Z" fill="#ffcc80"/><path d="M40 20 L60 20 L70 30 L30 30 Z" fill="#3949ab"/><rect x="47" y="78" width="6" height="10" fill="#424242" /></svg>
                <h2>We are excited to have you join the ALLEN family!</h2><p>What should we call you?</p>
                <input type="text" id="fullName" class="text-input" placeholder="Student's full name" required><button type="button" class="btn-primary" onclick="nextStep()">Next</button>
            </div>
            <!-- Step 2: Goal -->
            <div class="step" data-step="2">
                <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="25" y="75" width="50" height="10" rx="3" fill="#1e88e5"/><rect x="35" y="65" width="30" height="10" fill="#42a5f5"/><rect x="45" y="40" width="10" height="25" fill="#1565c0"/><circle cx="50" cy="30" r="12" fill="#ffc107"/><path d="M 50 18 A 12 12 0 0 0 50 42" fill="#ffca28"/><path d="M65 80 L60 75 L60 60 L70 55 L75 60 L75 75 Z" fill="#43a047"/><path d="M63 78 L77 78 L77 75 L63 75Z" fill="#e8f5e9"/></svg>
                <h2 id="greeting-name">Hi, [Name]!</h2><p>Please tell us what you are preparing for.</p>
                <div class="selection-grid" id="goal-selection" style="grid-template-columns: repeat(2, 1fr);">
                    <button type="button" class="selection-btn" data-value="Prep (6-10)">Prep (Class 6-10)</button>
                    <button type="button" class="selection-btn" data-value="Prep (11-12)">Prep (Class 11-12)</button>
                </div>
            </div>
            <!-- Step 3: Class -->
            <div class="step" data-step="3">
                <svg class="illustration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="25" y="75" width="50" height="10" rx="3" fill="#1e88e5"/><rect x="35" y="65" width="30" height="10" fill="#42a5f5"/><rect x="45" y="40" width="10" height="25" fill="#1565c0"/><circle cx="50" cy="30" r="12" fill="#ffc107"/><path d="M 50 18 A 12 12 0 0 0 50 42" fill="#ffca28"/><path d="M65 80 L60 75 L60 60 L70 55 L75 60 L75 75 Z" fill="#43a047"/><path d="M63 78 L77 78 L77 75 L63 75Z" fill="#e8f5e9"/></svg>
                <h2 id="class-heading">You selected, [Goal]!</h2><p id="class-subheading"></p>
                <div class="selection-grid" id="class-selection"></div>
            </div>
            <!-- Steps 4, 5, 6... -->
            <div class="step" data-step="4"><!-- ...Board Selection... --></div>
            <div class="step" data-step="5"><!-- ...Additional Info... --></div>
            <div class="step" data-step="6"><!-- ...Thank You... --></div>
        </form>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyD-ers6CRuH8bCFomXJHuLxPWff-Xa4ZVk", authDomain: "xperts-data.firebaseapp.com", projectId: "xperts-data", storageBucket: "xperts-data.firebasestorage.app", messagingSenderId: "934675149024", appId: "1:934675149024:web:23486a5f38f65f103ce085" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let currentStep = 1; const totalSteps = 5; const formData = { mobileNumber: localStorage.getItem('mobileForSignup') };
        // ... (Functions for showStep, nextStep, prevStep are the same) ...

        document.querySelectorAll('.selection-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const parent = btn.parentElement;
                parent.querySelectorAll('.selection-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                const key = parent.id.split('-')[0];
                formData[key] = btn.dataset.value;
                if (key === 'goal') { updateClassOptions(formData.goal); }
                setTimeout(nextStep, 200);
            });
        });

        function updateClassOptions(goal) {
            const classSelection = document.getElementById('class-selection');
            const classHeading = document.getElementById('class-heading');
            classSelection.innerHTML = ''; let classes = [];
            classHeading.textContent = `You selected, ${goal}!`;

            if (goal === 'Prep (11-12)') {
                classes = [{val: "11", text: "11th"}, {val: "12", text: "12th"}];
                classSelection.style.gridTemplateColumns = 'repeat(2, 1fr)';
            } else if (goal === 'Prep (6-10)') {
                classes = [{val: "6", text: "6th"}, {val: "7", text: "7th"}, {val: "8", text: "8th"}, {val: "9", text: "9th"}, {val: "10", text: "10th"}];
                classSelection.style.gridTemplateColumns = 'repeat(3, 1fr)';
            }
            
            classes.forEach(c => {
                 const btn = document.createElement('button');
                 btn.type = 'button'; btn.className = 'selection-btn';
                 btn.dataset.value = c.val; // Value is "6", "11", etc.
                 btn.textContent = c.text;
                 btn.addEventListener('click', () => {
                    document.querySelectorAll('#class-selection .selection-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    formData.class = c.val; // Saves class as "6", "11", etc.
                    setTimeout(nextStep, 200);
                 });
                 classSelection.appendChild(btn);
            });
        }

        document.getElementById('final-submit-btn').addEventListener('click', async () => {
            formData.parentName = document.getElementById('parentName').value.trim();
            formData.dob = document.getElementById('dob').value;
            formData.email = document.getElementById('email').value.trim();
            formData.password = document.getElementById('password').value;
            if (!formData.parentName || !formData.dob || !formData.email || !formData.password) { alert('Please fill all fields.'); return; }

            const dataToSave = { ...formData };
            dataToSave.role = 'Student'; dataToSave.isAllowed = false;
            
            // The logic is now simple: We save the clean data directly.
            await db.collection('users').add(dataToSave);
            // ... (redirect logic) ...
        });
    </script>
</body>
                                                                                                                                                                                                                                                                                                                                                                                                    </html>
